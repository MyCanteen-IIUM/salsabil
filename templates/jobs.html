<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postes Disponibles - Job Application</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container navbar-container">
                <button class="menu-toggle" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <a href="/jobs" class="logo-link">
                    <div class="logo">
                        <img src="{{ url_for('static', filename='img/logo.jpeg') }}" alt="Logo Salsabil" class="logo-img">
                        <div class="logo-text-container">
                            <span class="logo-text">Application</span>
                            <span class="logo-subtitle">Trouvez votre prochain d√©fi</span>
                        </div>
                    </div>
                </a>
                <ul class="nav-links" id="navLinks">
                    <li><a href="https://salsabil-km.com/fr/" class="nav-link">Accueil</a></li>
                    <li class="dropdown">
                        <a href="https://salsabil-km.com/fr/about" class="nav-link dropdown-toggle">
                            Qui sommes-nous
                            <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="https://salsabil-km.com/fr/about#history" class="dropdown-item">Histoire</a></li>
                            <li><a href="https://salsabil-km.com/fr/about#vision" class="dropdown-item">Vision</a></li>
                            <li><a href="https://salsabil-km.com/fr/about#message" class="dropdown-item">Mission</a></li>
                            <li><a href="https://salsabil-km.com/fr/about#values" class="dropdown-item">Valeurs</a></li>
                            <li><a href="https://salsabil-km.com/fr/about#objectives" class="dropdown-item">Objectifs</a></li>
                        </ul>
                    </li>
                    <li><a href="https://salsabil-km.com/fr/products" class="nav-link"> Nos produits</a></li>
                    <li><a href="https://salsabil-km.com/fr/events" class="nav-link"> √âv√©nements</a></li>
                    <li><a href="https://salsabil-km.com/fr/achievements" class="nav-link"> R√©alisations</a></li>
                    <li><a href="https://salsabil-km.com/fr/gallery" class="nav-link"> Exposition</a></li>
                    <li><a href="https://salsabil-km.com/fr/news" class="nav-link"> Nouvelles</a></li>
                    <li><a href="https://salsabil-km.com/fr/contact" class="nav-link"> Contact</a></li>
                    <li><a href="/jobs" class="nav-link active"> Postes Disponibles</a></li>
                    <li><a href="/jobs_ar" class="nav-link">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="jobs-header">
            <div class="container">
                <h2>Postes Disponibles</h2>
                <p>Trouvez votre prochain d√©fi professionnel</p>
            </div>
        </section>

        <section class="jobs-list">
            <div class="container">
                {% if jobs %}
                    <!-- Filtres de recherche -->
                    <div class="search-filters">
                        <div class="filter-header">
                            <h3>üîç Rechercher et Filtrer</h3>
                            <button onclick="toggleFilters()" class="btn-toggle-filters" id="toggleFiltersBtn">
                                <span id="filterToggleText">Masquer les filtres</span>
                                <svg id="filterToggleIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="18 15 12 9 6 15"></polyline>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="filters-container" id="filtersContainer">
                            <div class="filter-row-single">
                                <!-- Recherche par mot-cl√© -->
                                <div class="filter-group">
                                    <label for="searchInput">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <path d="m21 21-4.35-4.35"></path>
                                        </svg>
                                        Recherche
                                    </label>
                                    <input type="text" id="searchInput" placeholder="Titre, comp√©tences..." onkeyup="filterJobs()">
                                </div>
                                
                                <!-- Filtre par d√©partement -->
                                <div class="filter-group">
                                    <label for="departmentFilter">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="7" height="7"></rect>
                                            <rect x="14" y="3" width="7" height="7"></rect>
                                            <rect x="14" y="14" width="7" height="7"></rect>
                                            <rect x="3" y="14" width="7" height="7"></rect>
                                        </svg>
                                        D√©partement
                                    </label>
                                    <select id="departmentFilter" onchange="filterJobs()">
                                        <option value="">Tous</option>
                                        {% set departments = [] %}
                                        {% for job in jobs %}
                                            {% if job.department not in departments %}
                                                {% set _ = departments.append(job.department) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% for dept in departments|sort %}
                                        <option value="{{ dept }}">{{ dept }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <!-- Filtre par localisation -->
                                <div class="filter-group">
                                    <label for="locationFilter">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                        Localisation
                                    </label>
                                    <select id="locationFilter" onchange="filterJobs()">
                                        <option value="">Toutes</option>
                                        {% set locations = [] %}
                                        {% for job in jobs %}
                                            {% if job.location not in locations %}
                                                {% set _ = locations.append(job.location) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% for loc in locations|sort %}
                                        <option value="{{ loc }}">{{ loc }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <!-- Filtre par type de contrat -->
                                <div class="filter-group">
                                    <label for="typeFilter">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                            <polyline points="10 9 9 9 8 9"></polyline>
                                        </svg>
                                        Type
                                    </label>
                                    <select id="typeFilter" onchange="filterJobs()">
                                        <option value="">Tous</option>
                                        {% set types = [] %}
                                        {% for job in jobs %}
                                            {% if job.type not in types %}
                                                {% set _ = types.append(job.type) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% for type in types|sort %}
                                        <option value="{{ type }}">{{ type }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <!-- Filtre par langue -->
                                <div class="filter-group">
                                    <label for="languageFilter">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M2 12h20"></path>
                                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                        </svg>
                                        Langue
                                    </label>
                                    <select id="languageFilter" onchange="filterJobs()">
                                        <option value="">Toutes</option>
                                        <option value="Arabe">üá∏üá¶ Arabe</option>
                                        <option value="Anglais">üá¨üáß Anglais</option>
                                        <option value="Fran√ßais">üá´üá∑ Fran√ßais</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="filter-actions">
                                <button onclick="resetFilters()" class="btn-reset">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"></polyline>
                                        <polyline points="23 20 23 14 17 14"></polyline>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                    </svg>
                                    R√©initialiser
                                </button>
                                <div class="results-count">
                                    <span id="resultsCount">{{ jobs|length }}</span> poste(s) trouv√©(s)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="jobs-grid">
                        {% for job in jobs %}
                        <div class="job-card" 
                             data-title="{{ job.title|lower }}" 
                             data-description="{{ job.description|lower }}"
                             data-department="{{ job.department }}"
                             data-location="{{ job.location }}"
                             data-type="{{ job.type }}"
                             data-languages="{{ job.langues_requises|lower if job.langues_requises else '' }}"
                             data-requirements="{{ job.requirements|join(' ')|lower }}">
                            <div class="job-header">
                                <h3>{{ job.title }}</h3>
                                <div class="job-badges">
                                    <span class="job-type {{ job.type.lower() }}">{{ job.type }}</span>
                                    {% if is_closing_soon(job.deadline) %}
                                    <span class="badge-closing-soon">‚è∞ Fermeture Prochaine</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="job-meta">
                                <span class="job-department">üìÅ {{ job.department }}</span>
                                <span class="job-location">üìç {{ job.location }}</span>
                                <span class="job-deadline">üìÖ Date limite: {{ job.deadline }}</span>
                            </div>
                            <p class="job-description">{{ job.description }}</p>
                            <div class="job-requirements">
                                <h4>Comp√©tences requises :</h4>
                                <ul>
                                    {% for req in job.requirements[:3] %}
                                    <li>{{ req }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% if job.langues_requises %}
                            <div class="job-languages">
                                <h4>üåê Langues requises :</h4>
                                <div class="language-tags">
                                    {% set langues = job.langues_requises.split(', ') %}
                                    {% for langue in langues %}
                                    <span class="language-tag">
                                        {% if langue == 'Arabe' %}üá∏üá¶
                                        {% elif langue == 'Anglais' %}üá¨üáß
                                        {% elif langue == 'Fran√ßais' %}üá´üá∑
                                        {% endif %}
                                        {{ langue }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            <div class="job-footer">
                                <div class="job-footer-left">
                                    <span class="job-date">Publi√© le {{ job.posted_date }}</span>
                                    <div class="job-share">
                                        <span class="share-label">Partager:</span>
                                        <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://localhost:5000/jobs/{{ job.id }}" target="_blank" class="share-btn linkedin" title="Partager sur LinkedIn">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                                            </svg>
                                        </a>
                                        <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:5000/jobs/{{ job.id }}" target="_blank" class="share-btn facebook" title="Partager sur Facebook">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
                                            </svg>
                                        </a>
                                        <a href="https://twitter.com/intent/tweet?url=http://localhost:5000/jobs/{{ job.id }}&text=D√©couvrez cette offre: {{ job.title }}" target="_blank" class="share-btn twitter" title="Partager sur X (Twitter)">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                                            </svg>
                                        </a>
                                        <a href="https://wa.me/?text=D√©couvrez cette offre: {{ job.title }} - http://localhost:5000/jobs/{{ job.id }}" target="_blank" class="share-btn whatsapp" title="Partager sur WhatsApp">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                                            </svg>
                                        </a>
                                        <a href="mailto:?subject=Offre d'emploi: {{ job.title }}&body=D√©couvrez cette offre: http://localhost:5000/jobs/{{ job.id }}" class="share-btn email" title="Partager par email">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M0 3v18h24v-18h-24zm6.623 7.929l-4.623 5.712v-9.458l4.623 3.746zm-4.141-5.929h19.035l-9.517 7.713-9.518-7.713zm5.694 7.188l3.824 3.099 3.83-3.104 5.612 6.817h-18.779l5.513-6.812zm9.208-1.264l4.616-3.741v9.348l-4.616-5.607z"/>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                                <a href="/apply/{{ job.id }}" class="btn-apply">Postuler</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="no-jobs">
                        <p>Aucun poste disponible pour le moment. Revenez bient√¥t !</p>
                    </div>
                {% endif %}
            </div>
        </section>

        <section class="cta-section">
            <div class="container">
                <h3>Vous ne trouvez pas le poste id√©al ?</h3>
                <p>Envoyez-nous une candidature spontan√©e, nous serions ravis de vous rencontrer !</p>
                <a href="{{ url_for('apply', job_id=0) }}" class="btn-secondary">Candidature Spontan√©e</a>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Application de Travail. Tous droits r√©serv√©s.</p>
        </div>
    </footer>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                        <button onclick="this.parentElement.style.display='none'">&times;</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <script>
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            const menuToggle = document.querySelector('.menu-toggle');
            navLinks.classList.toggle('active');
            menuToggle.classList.toggle('active');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const navbar = document.querySelector('.navbar');
            const navLinks = document.getElementById('navLinks');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (!navbar.contains(event.target) && navLinks.classList.contains('active')) {
                navLinks.classList.remove('active');
                menuToggle.classList.remove('active');
            }
        });

        // Toggle dropdown on mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Masquer les filtres par d√©faut sur mobile
            if (window.innerWidth <= 768) {
                const container = document.getElementById('filtersContainer');
                const text = document.getElementById('filterToggleText');
                const icon = document.getElementById('filterToggleIcon');
                
                if (container) {
                    container.style.display = 'none';
                    text.textContent = 'Afficher les filtres';
                    icon.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
                }
            }
            
            document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const dropdown = this.closest('.dropdown');
                        const isActive = dropdown.classList.contains('active');
                        
                        // Fermer tous les autres dropdowns
                        document.querySelectorAll('.dropdown').forEach(d => {
                            d.classList.remove('active');
                        });
                        
                        // Toggle le dropdown actuel
                        if (!isActive) {
                            dropdown.classList.add('active');
                        }
                    }
                });
            });
        });

        // ============================================
        // SYST√àME DE FILTRAGE DES POSTES
        // ============================================
        
        function toggleFilters() {
            const container = document.getElementById('filtersContainer');
            const btn = document.getElementById('toggleFiltersBtn');
            const text = document.getElementById('filterToggleText');
            const icon = document.getElementById('filterToggleIcon');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                text.textContent = 'Masquer les filtres';
                icon.innerHTML = '<polyline points="18 15 12 9 6 15"></polyline>';
            } else {
                container.style.display = 'none';
                text.textContent = 'Afficher les filtres';
                icon.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
            }
        }
        
        function filterJobs() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const departmentValue = document.getElementById('departmentFilter').value;
            const locationValue = document.getElementById('locationFilter').value;
            const typeValue = document.getElementById('typeFilter').value;
            const languageValue = document.getElementById('languageFilter').value.toLowerCase();
            
            const jobCards = document.querySelectorAll('.job-card');
            let visibleCount = 0;
            
            jobCards.forEach(card => {
                const title = card.getAttribute('data-title');
                const description = card.getAttribute('data-description');
                const requirements = card.getAttribute('data-requirements');
                const department = card.getAttribute('data-department');
                const location = card.getAttribute('data-location');
                const type = card.getAttribute('data-type');
                const languages = card.getAttribute('data-languages');
                
                // V√©rifier tous les crit√®res
                const matchesSearch = !searchValue || 
                                     title.includes(searchValue) || 
                                     description.includes(searchValue) ||
                                     requirements.includes(searchValue);
                                     
                const matchesDepartment = !departmentValue || department === departmentValue;
                const matchesLocation = !locationValue || location === locationValue;
                const matchesType = !typeValue || type === typeValue;
                const matchesLanguage = !languageValue || languages.includes(languageValue);
                
                // Afficher/masquer la carte
                if (matchesSearch && matchesDepartment && matchesLocation && matchesType && matchesLanguage) {
                    card.style.display = 'block';
                    // Animation d'apparition
                    card.style.animation = 'fadeIn 0.3s ease-in';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Mettre √† jour le compteur
            document.getElementById('resultsCount').textContent = visibleCount;
            
            // Message si aucun r√©sultat
            const jobsGrid = document.querySelector('.jobs-grid');
            let noResultsMsg = document.getElementById('noResultsMessage');
            
            if (visibleCount === 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'noResultsMessage';
                    noResultsMsg.className = 'no-results-message';
                    noResultsMsg.innerHTML = `
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <h3>Aucun poste trouv√©</h3>
                        <p>Essayez de modifier vos crit√®res de recherche ou r√©initialisez les filtres.</p>
                    `;
                    jobsGrid.parentNode.insertBefore(noResultsMsg, jobsGrid);
                }
                noResultsMsg.style.display = 'block';
                jobsGrid.style.display = 'none';
            } else {
                if (noResultsMsg) {
                    noResultsMsg.style.display = 'none';
                }
                jobsGrid.style.display = 'grid';
            }
        }
        
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('departmentFilter').value = '';
            document.getElementById('locationFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('languageFilter').value = '';
            
            filterJobs();
            
            // Animation de feedback
            const resetBtn = document.querySelector('.btn-reset');
            resetBtn.style.transform = 'rotate(360deg)';
            setTimeout(() => {
                resetBtn.style.transform = 'rotate(0deg)';
            }, 300);
        }
        
        // Animation fadeIn pour les cartes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
